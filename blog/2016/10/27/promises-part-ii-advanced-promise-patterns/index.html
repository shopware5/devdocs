<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Promises Part II - Advanced promise patterns</title><meta name="description" content="In the last blog post, we took a brief look on promises in JavaScript. They are a great way to deal with asynchronous operations and providing you with a g"><meta name="keywords" content="javascript, promises, theme"><meta name="author" content="Stephan Pohl"><link rel="author" href="https://developers.shopware.com/blog/authors/stp"><!-- Facebook --><meta property="og:title" content="Promises Part II - Advanced promise patterns"><meta property="og:type" content="article"><meta property="og:image" content=""><meta property="og:url" content="/blog/2016/10/27/promises-part-ii-advanced-promise-patterns"><meta property="og:description" content="In the last blog post, we took a brief look on promises in JavaScript. They are a great way to deal with asynchronous operations and providing you with a g"><!-- Twitter --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Promises Part II - Advanced promise patterns"><meta name="twitter:description" content="In the last blog post, we took a brief look on promises in JavaScript. They are a great way to deal with asynchronous operations and providing you with a g"><meta name="twitter:image" content=""><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="theme-color" content="#26556f"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:700,600,400" type="text/css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://developers.shopware.com/assets/css/docsearch.min.1515505351.css"><link rel="stylesheet" href="https://developers.shopware.com/assets/css/basic.1515505351.css" media="screen"><link rel="alternate" type="application/atom+xml" href="https://developers.shopware.com/blog/atom.xml" title="Shopware Developer blog feed"></head><body>
<div class="wrapper">

    <header class="header--main"><a href="https://developers.shopware.com/" class="offcanvas--trigger" title="Navigation">
            <i class="icon-list"></i>
        </a>

        <a href="https://developers.shopware.com/" title="Shopware Developer Documentation" class="logo">
            <img src="https://developers.shopware.com/assets/img/shopware_developers_logo_white.1515505351.svg"></a>

    </header><div id="searchBox">
        <form action="#" method="get" id="search-form">
            <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off"><button id="search-action"></button>
        </form>
    </div>

    <nav class="navi--main" data-offcanvas="true"><div class="navi--content">
            <ul class="navi--tree"><li class="navi--chapter">
                    <a href="/developers-guide/" class="navi--link has--children">
                       Developer Guides
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/plugin-guide/">
                                Developing plugins
                            </a>

                                                            <ul class="navi--sub-tree is--numbered"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-quick-start/">
                                                Quick start guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/example-plugin/">
                                                Storefront extension
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/controller/">
                                                Controllers
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/models/">
                                                Models
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/event-guide/">
                                                Events
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/services/">
                                                Services
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-configuration/">
                                                Plugin configuration
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-testing/">
                                                Plugin testing
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-license/">
                                                Plugin License
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-plugin-update-guide/">
                                                Plugin update guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-extension-by-plugin/">
                                                Extend an existing plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/legacy-plugin-system/">
                                                The legacy Plugin System
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/general-resources/">
                                General Resources
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/cheat-sheet/">
                                                Cheat-Sheet
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/phpstorm/">
                                                Setting up PhpStorm
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-upgrade-guide-for-developers/">
                                                Upgrade Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-performance-for-devs/">
                                                Performance Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/debugging/">
                                                Debugging Shopware
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/coding-standards/">
                                                Coding Standards
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/elasticsearch/">
                                                Elasticsearch
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-config/">
                                                config.php settings
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/blog/2015/06/09/understanding-the-shopware-hook-system/">
                                                Hooks
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/blog/2015/08/11/the-shopware-seo-engine/">
                                                SEO Engine
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-media-service/">
                                                MediaService
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/http-cache/">
                                                HTTP Cache
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/address-management-guide/">
                                                Address Management
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/attribute-system/">
                                                Attributes
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/csrf-protection/">
                                                CSRF Protection
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/dic-tags/">
                                                Dependency Injection Tags
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-cli-commands/">
                                                CLI commands
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/implementing-your-own-captcha/">
                                                Captcha
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-search-bundle/">
                                                SearchBundle
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-core-service-extensions/">
                                                Service extensions
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/entity-relationship-model/">
                                                Entity relationship model
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/password-encoder/">
                                                Password encoder
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/global-variables-in-templates/">
                                                Global variables in templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/media-optimizer/">
                                                Media Optimizer
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/customer-streams-extension/">
                                                Customer - Search &amp; Streams
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/product-export/">
                                                Product exports
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/tutorials/">
                                Tutorials
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/custom-shopping-world-elements/">
                                                Create custom shopping worlds elements
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/digital-publishing-elements/">
                                                Create custom digital publishing elements
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/emotion-preset-plugin/">
                                                Create custom emotion preset plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-lastregistrations-widget/">
                                                Create your own backend widget
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/payment-plugin/">
                                                Create custom payment plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-slugify/">
                                                Create custom url slugger
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/risk-rules/">
                                                Risk Rules
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/vagrant-phpstorm/">
                                                Vagrant and PHPStorm
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/backend-and-extjs/">
                                Backend and ExtJS
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-extension/">
                                                Extending the backend
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/basics/">
                                                Basics
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/listing/">
                                                Listing
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/detail/">
                                                Detail
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/associations/">
                                                Associations
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/listing-extensions/">
                                                Listing extensions
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/batch-processes/">
                                                Batch processes
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/lightweight-backend-modules/">
                                                Lightweight backend modules
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/backend-icons/">
                                                Backend icon set
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-escaping/">
                                                Backend escaping
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/rest/">
                                REST API
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/">
                                                REST API Basics
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/article/">
                                                The article resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/customer/">
                                                The customer resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/order/">
                                                The order resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/translation/">
                                                The translation resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/category/">
                                                The category resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/media/">
                                                The media resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/merge-mode/">
                                                The merge mode
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/cache/">
                                                The cache resources
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/batch/">
                                                The batch mode
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/api-resource-user/">
                                                The user resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/customer-streams/">
                                                Customer Streams
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/filter/">
                                                Filter
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/payment/">
                                                Payment
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/models/">
                                                Models
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/plugin-api-extension/">
                                                Create your own endpoint
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/extend-api-resource/">
                                                Extend a REST API resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/faq/">
                                                REST API FAQ
                                            </a>
                                        </li>
                                                                    </ul></li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/designers-guide/" class="navi--link has--children">
                       Frontend Guides
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/theme-guide/">
                                Developing Themes
                            </a>

                                                            <ul class="navi--sub-tree is--numbered"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/theme-startup-guide/">
                                                Theme Startup Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/getting-started/">
                                                Getting started with templating
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/smarty/">
                                                Getting started with Smarty
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/less/">
                                                Getting started with LESS
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/css-and-js-files-usage/">
                                                Using CSS and JavaScript
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/responsive-theme-default-components/">
                                                Using the theme default components
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/javascript-statemanager-and-pluginbase/">
                                                jQuery plugins &amp; the StateManager
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/configuration-using-theme-php/">
                                                Custom theme configuration
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/preparing-themes-for-the-community-store/">
                                                Preparing themes for the community store
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/designers-guide/general-resources/">
                                General Resources
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/eslint-for-plugins/">
                                                ESLint for plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/javascript-coding-style/">
                                                Javascript Coding Style
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/styletile/">
                                                UI Components
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/snippets/">
                                                Snippet Management
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/datepicker/">
                                                Datepicker
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/external-resources/">
                                                Embedding external resources
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/responsive-images/">
                                                Responsive images
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/smarty-plugins/">
                                                Smarty Plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/best-practice-theme-development/">
                                                Using the Grunt watcher
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/modify-jquery-plugins/">
                                                Modify jQuery plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/managing-third-party-dependencies-with-bower/">
                                                Managing dependencies with Bower
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/managing-third-party-dependencies-with-npm/">
                                                Managing dependencies with NPM
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/legacy-template-development-in-shopware-5/">
                                                Legacy template development
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/how-to-use-karma/">
                                                Testing with Karma
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/designers-guide/tutorials/">
                                Tutorials
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/find-smarty-blocks/">
                                                How to find smarty blocks
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-templates/">
                                                Adding custom templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-listing-page/">
                                                Example: Custom listing page
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-detail-page/">
                                                Example: Custom Detail page
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/edit-newsletter-and-document-templates/">
                                                Edit newsletter and document templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/google-pagespeed-best-practise/">
                                                Google PageSpeed
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/browser-notice/">
                                                Outdated browser notification
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/range-slider-algorithm/">
                                                Range slider algorithm
                                            </a>
                                        </li>
                                                                    </ul></li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/community/" class="navi--link has--children">
                       Community
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/gitter/">
                                Gitter
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/contribution-guideline/">
                                Contribution Guideline
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/contributing-code/">
                                Contributing Code
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/irc/">
                                IRC Channel
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/labs/" class="navi--link has--children">
                       Labs
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/3d-product-visualization/">
                                3D Product visualization
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/shopping-cart-and-ordering-processes/">
                                Shopping Cart &amp; ordering processes
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/new-administration/">
                                New administration
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/internationalization/">
                                Internationalization
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/api/">
                                API
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/housekeeping/">
                                Housekeeping
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/sysadmins-guide/" class="navi--link has--children">
                       System Guides
                    </a>

                                        <ul class="navi--sub-tree"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/system-requirements/">
                                System requirements
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/installation-guide/">
                                Installation Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/update-guide/">
                                Update Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/shopware-5-performance-for-sysadmins/">
                                Performance Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/elasticsearch-setup/">
                                Elasticsearch setup
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/varnish-setup/">
                                Varnish setup
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/sessions/">
                                Sessions
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/shopware-cluster-setup/">
                                Cluster setup
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/blog/" class="navi--link">
                       Blog
                    </a>

                                    </li>

                            </ul></div>
    </nav><div class="devdocs content">

        <section id="search-results" style="display: none;"><h2 class="search-results--headline" id="search-results">Search results</h2>

            <div class="entries"></div>
        </section><div class="inner-container">

            <div class="info">

                
                                <a class="edit-on-github" href="https://github.com/shopware/devdocs/blob/master/source/blog/_posts/2016-10-27-advanced-promise-patterns.md" target="_blank"><i class="icon-github"></i> Edit this page on GitHub</a>
                
            </div>

                        <h1>
                Promises Part II - Advanced promise patterns
            </h1>
            
            <article class="blog-post"><div class="blog-authors">
                        <div class="blog-user-info">
    <div class="blog-avatar">
        <img src="https://developers.shopware.com/blog/img/authors/author_stp.jpg" width="50" height="50"></div>
    <div class="blog-user">
        <div class="user-info">
            <a rel="author" href="https://developers.shopware.com/blog/authors/stp">Stephan Pohl</a>
            <span class="user-title">, Developer</span>        </div>

        <div class="release">
            <span class="icon icon-clock"></span> October 27th, 2016
        </div>

        <div class="user-services">

                            <span class="user-service">
                    <a href="https://twitter.com/klarstil" target="_blank" title="Twitter Stephan Pohl">
                        <span class="service-desc">Twitter: </span> <i class="icon icon-twitter"></i>
                    </a>
                </span>
            
            
                            <span class="user-service">
                    <a href="https://github.com/klarstil" target="_blank" title="Github Stephan Pohl">
                        <span class="service-desc">Github: </span> <i class="icon icon-github"></i>
                    </a>
                </span>
                    </div>
    </div>
</div>
                    </div>
    
    <div class="blog-detail-text">
        <p>In the last blog post, we took a brief look on promises in JavaScript. They are a great way to deal with asynchronous operations and providing you with a great flow control. In this blog post we're taking a closer look on the <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-promise-constructor">Promise API</a> and more sophisticated patterns. If you haven't read the <a href="https://developers.shopware.com/blog/2016/10/12/promises-asynchronous-processes-made-easy/">last blog post</a>, consider reading it first, before you're continuing with this one.</p>

<h2 id="convert-jquery-promises-into-standard-compatible-promises">Convert jQuery promises into standard compatible promises</h2>

<p>I gave you a brief introduction to the <code>Deferred</code> object in jQuery and pointed out that a lot of jQuery's functions are working with promises already. The prime example is the <code>$.ajax()</code> method.</p>

<p>Let's assume we have a function named <code>fetchPost</code> which fetches data from an API endpoint:</p>

<pre><code>function fetchPost(id) {
    id = id || 1;

    return $.ajax({
        'url': 'https://jsonplaceholder.typicode.com/posts/' + id
    });
}

// Call the function and output the response
fetchPost(1).done(function(response) {
    alert(JSON.stringfy(response));
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/u3sb8785/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Using the jQuery promise implementation</em></p>

<p>We're using <a href="http://api.jquery.com/promise/">jQuery's Promise</a> object to fulfill the promise. Now assume you're doing the transition from jQuery promises to standard compatible promises in your application. It would be very irritating for you and any third party developer to have a mix of both promise implementations in your application to deal with.</p>

<p>You can overcome this issue using <code>Promise.resolve()</code>, which lets you transform a jQuery promise to a standard compatible promise for example:</p>

<pre><code>function fetchPost(id) {
    id = id || 1;
    
    var jQueryPromise = $.ajax({
        'url': 'https://jsonplaceholder.typicode.com/posts/' + id
    });
    
    return Promise.resolve(jQueryPromise);
}

fetchPost(1).then(function(response) {
    alert(JSON.stringify(response));
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/pa0pg92a/3/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Transforming jQuery promises into standard promises</em></p>

<p>The only difference in the above code is that we're not returning the jQuery promise right away. We're wrapping it in a call of <code>Promise.resolve()</code>. The call returning a promise object that is resolved with the given value which is the AJAX response in this example.</p>

<p>Sometimes you're finding yourself in the position that you don't know if you're dealing with a promise or not. In this case <code>Promise.resolve()</code> can come in handy too.</p>

<p>Let's assume we're working with a lot of numbers, our application uses promises but a third-party library does not. If you don't know what you're dealing with, always use <code>Promise.resolve()</code>:</p>

<pre><code>function getNumber(num) {
    // We don't know if num is a promise or not, so we're calling Promise.resolve() to always return a new promise object.
    return Promise.resolve(num);
}

// Our given value IS NOT a promise
getNumber(10).then(function(num) {
    alert('The number is: ' + num);
});

// Our given value IS a promise
getNumber(Promise.resolve(10)).then(function() {
    alert('The number is: ' + num);
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/xz18dj0u/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Working with a mixed environment</em></p>

<p>This pattern enables you to use promises throughout your application and use its advantages for a better flow control.</p>

<p>If you want a little more control and want to terminate if a value is a promise you can use this little code snippet:</p>

<pre><code>function isPromise(obj) {
    return !!obj &amp;&amp; (typeof obj === 'object' || typeof obj === 'function') &amp;&amp; typeof obj.then === 'function';
}
</code></pre>

<p>Check out the <a href="https://github.com/then/is-promise">github repository</a> with the full library from <a href="https://github.com/then">@then</a>.</p>

<h2 id="parallel-&amp;-sequential-operations">Parallel &amp; sequential operations</h2>

<p>In the one of the previous example we created a function called <code>fetchPost</code> which fetches a blog post from an API endpoint. Now imagine you want to fetch multiple posts in parallel. We're continuing using this function for the sake of simplicity.</p>

<p>Let's take a look on a parallel operation first. In the following example we're having an array with post IDs we want to fetch:</p>

<pre><code>var postIds = [ 2, 4, 7, 42 ];

Promise.all(items.map(fetchPost)).then(function(results) {
    console.log(results);
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/o2h20qhq/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Parallel operations using promises</em></p>

<p>In the above example we're using <code>Promise.all()</code> which returns a promise that will be fulfilled when all the returned promises in the given argument have been resolved or rejected. The argument has to be an iterable object such as an array though.</p>

<p>Running a collection of asynchronous operations in sequence takes a little more effort to come by. You have to chain the promises, so each operation doesn't starts until the previous operation has been fulfilled. We're taking the same example as above but this time we're putting it in sequence:</p>

<pre><code>var postIds = [ 2, 4, 7, 42 ];

var sequencePromise = postIds.reduce(function(promise, item) {
    return promise.then(function(results) {
        return fetchPost(item)
            .then(results.push.bind(results))
            .then(function() { return results; });
    });
}, Promise.resolve([]));
    
sequencePromise.then(function(results) {
    console.log(results);
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/6wtsps6m/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Sequential operations using promises</em></p>

<p>There's a lot of buzz going on in the above example, so let's break it down. <code>Array.reduce()</code> applies a method against an accumulator and each value of the array to reduce it to a single value. The first argument is the callback method, the second one is the initial value. In our case, we're using a new promise object which is fulfilled with an empty array as a value. We're using the initial promise to call the <code>fetchPost()</code>, using the returned promise from the <code>fetchPost</code> method to write back the response of the call to our <code>results</code> array and returning the filled up <code>results</code> array which we defined as the argument of the initial value.</p>

<h2 id="error-handling">Error handling</h2>

<p>Sadly we're not living in a perfect world where everything goes well. Sometimes it's like a rollercoaster, you have good days but sometimes everything that can go wrong goes wrong (<a href="https://en.wikipedia.org/wiki/Murphy's_law">Murphy's law</a>) - it's the same when you're coding. Errors can always occur along the way, a server can be offline temporarily or the user simply inputs something wrong.</p>

<p>Exceptions in JavaScript are synchronous which doesn't go along well in an asynchronous operation. We're bringing back the <a href="https://developers.shopware.com/blog/2016/10/12/promises-asynchronous-processes-made-easy/#getting-started-with-promises">workflow diagram</a> in our mind. A promise can have multiple states. It can be pending, fulfilled or rejected. In our case we want to take a closer look on the rejected state - it provides us with the ability to reject a promise when an error occurred.</p>

<p>One of the most useful features of promises is the automatic propagation of errors. However this feature is only useful if errors are correctly propagated up the call stack. If you're writing a promise chain and ignore the <code>reject()</code> method, errors in the chain will be silently ignored which can hide serious bugs in your application:</p>

<pre><code>function random() {
    return new Promise(function(fulfill, reject) {
        if (Math.random() &gt; 0.5) {
            fulfill('Yeah');
        } else {
            throw new Error('Oh no something went wrong');
        }
    });
}

random().then(function(results) {
    alert('Success');
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/rn62zntv/1/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Error handling with promises - the wrong way</em></p>

<p>As you can see in the above code and playing around with the example, the error will never be reported and silently ignored, which is a worst case scenario. This is the place where the <code>reject()</code> method comes in handy. The modification is very simple but has a huge impact on your application and the propagation of errors. Always make sure you're adding a <code>catch()</code> callback to catch the error.</p>

<pre><code>function random() {
    return new Promise(function(fulfill, reject) {
        if (Math.random() &gt; 0.5) {
            fulfill('Yeah');
        } else {
            reject(new Error('Oh no something went wrong'));
        }
    });
}

random().then(function(results) {
    alert('Success');
}).catch(function(err) {
     alert('Error');
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/few8L7gm/1/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Error handling with promises - the right way</em></p>

<p>We're switching out the exception with a call of <code>reject()</code> and using the exception as the first argument. Now we can use the benefits of the automatic propagation feature. Returning a promise has the benefit that people can always handle all errors in the same consistent way.</p>

<p>Keep in mind, you can use the <code>Promise.reject()</code> method to create a new promise object with a rejected state and an error instead of instantiating a new promise object:</p>

<pre><code>Promise.reject(new Error('Oh no something went wrong'));
</code></pre>

<p>Here are some brief advices for handling errors in promises:</p>

<ul><li>Don't swallow errors in your promise chain. Either handle the error from the promise directly in the chain or return the promise to the caller, so it can be handled elsewhere.</li>
<li>If you're dealing with multiple promise chains use <code>Promise.all()</code> to catch any error which may occur in the chain.</li>
<li>Bubble up errors the promise chain to the caller and consider throwing the exception to trigger the default unhandled error notifications (e.g. <code>window.onerror</code> or the <code>error</code> event in <code>process</code> for example). This is a convenient way to handle errors in your promise chains, especially when you have a generic error handler in your application already.</li>
</ul><h2 id="passing-state">Passing state</h2>

<p>Sometimes you want to pass around state in your promise chain. A common example is solving relationships between two data sets for example an &quot;n-1&quot; relationship between multiple posts and an author. You want to fetch the post and author asynchronously and render both objects when both operations are fulfilled.</p>

<p>Again, we're using our <code>fetchPost()</code> function to fetch the post from the endpoint. We're adding a new function called <code>fetchAuthor()</code> which fetches the author from the endpoint:</p>

<pre><code>function fetchPost(id) {
     id = id || 1;
    return Promise.resolve($.ajax({
        'url': 'https://jsonplaceholder.typicode.com/posts/' + id
    }));
}

function fetchAuthor(id) {
     id = id || 1;
    return Promise.resolve($.ajax({
        'url': 'https://jsonplaceholder.typicode.com/users/' + id
    }));
}

fetchPost(1).then(function(post) {
    return Promise.all([ post, fetchAuthor(post.userId) ]);
}).then(function(results) {
    var data = {
        'post': results[0],
        'user': results[1]
    };
    
    // Do something with the data...
    console.log(data)
});
</code></pre>

<p><iframe src="https://jsfiddle.net/klarstil/hkm9o9rp/embedded/result/" frameborder="0" width="100%" height="250px"></iframe></p>

<p><em>Passing state around in a promise chain</em></p>

<p>Unfortunately there's no great way to solve this problem, so you're best bet is our old friend <code>Promise.all()</code>. We're building up an array of all the objects we need and waiting for the new promises while we're keeping the existing values (e.g. state).</p>

<p>Calling <code>Promise.all()</code> returns a promise with the post and the author. The promise will be fulfilled once the author has been fetched from the endpoint. We have to use <code>Promise.all()</code> here because returning an array from a <code>then()</code> callback will not wait for all promises in the array to fulfill. The second argument would still have a promise of the author instead of the author's data we're looking for.</p>

<h2 id="who-will-be-first?">Who will be first?</h2>

<p><code>Promise.race()</code> is an often overlooked feature of the <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-promise-constructor">Promise API</a>. It provides you with the ability to race two promises against each other. This is quite useful for a timeout method for example. Our goal is to create a function <code>delay()</code> which represents the timeout delay and a method <code>timeout()</code> which is, well, the actual timeout. <code>timeout()</code>'s first argument is a promise and the second argument is the timeout time.</p>

<pre><code>function delay(time) {
    return new Promise(function (fulfill) {
        setTimeout(fulfill, time);
    });
}

function timeout(promise, time) {
    return Promise.race([
        promise,
        delay(time).then(function () {
            // When the delay promise will be settled first, we're throwing an exception.
            throw new Error('Operation timed out');
          });
      ]);
}

timeout(fetchPost(1), 500).then(function(post) {
    console.log(post);
});
</code></pre>

<p>Whichever promise settles (fulfills or rejects) first wins the race and determines the result.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Promises are an awesome utility to get rid of the &quot;pyramid of doom&quot; and enhance the flow control of your application. The transition from jQuery promises to the standard compatible implementation is quite simple and the additional methods in the API gives us an excellent flexibility to solve common tasks when working with asynchronous operations. The automatic propagation of errors is a powerful feature. It has some pitfalls you can easily overcome when you're using the API correctly.</p>

<p>This blog post rounds up the JavaScript promises series in this blog.</p>

    </div>

    <a href="https://developers.shopware.com/blog/" title="Back to overview" class="btn btn-default">Back to overview</a>

    <div class="clearfix"></div>
</article></div>

        <div class="clearfix"></div>
    </div>
    
    <!-- Footer -->
            <footer class="main-footer"><div class="footer--container">
                <div class="copyright">2018  shopware AG - All rights reserved</div>
                <div class="footer--links">
                    <a href="https://en.shopware.com/legal-notice" target="_blank" title="Imprint">Imprint</a> |
                    <a href="https://en.shopware.com/gtc" target="_blank" title="Terms and Conditions">Terms and Conditions</a>
                </div>
            </div>
        </footer></div>

<script src="//cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/languages/less.min.js"></script><script src="https://developers.shopware.com/assets/js/anchor.min.1515505351.js"></script><script src="https://developers.shopware.com/assets/js/jquery.expandCode.1515505351.js"></script><script src="https://developers.shopware.com/assets/js/jquery.toc.1515505351.js"></script><script src="https://developers.shopware.com/assets/js/jquery.offcanvas.1515505351.js"></script><script src="https://developers.shopware.com/assets/js/app.1515505351.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><!-- Google Tag Manager --><noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5ZGXBG" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(), event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
            '//www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5ZGXBG');</script><!-- End Google Tag Manager --></body></html>