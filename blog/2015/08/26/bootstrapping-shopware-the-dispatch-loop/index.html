<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Bootstrapping Shopware: The dispatch loop</title><meta name="description" content="When writing Shopware plugins, you will usually use events like Enlight_Controller_Dispatcher_ControllerPath_Frontend_Test
or Enlight_Controller_Action_Pre"><meta name="keywords" content="dispatch loop, controller, events, Shopware bootstrapping"><meta name="author" content="Daniel NÃ¶gel"><link rel="author" href="https://developers.shopware.com/blog/authors/dn"><!-- Facebook --><meta property="og:title" content="Bootstrapping Shopware: The dispatch loop"><meta property="og:type" content="article"><meta property="og:image" content=""><meta property="og:url" content="/blog/2015/08/26/bootstrapping-shopware-the-dispatch-loop"><meta property="og:description" content="When writing Shopware plugins, you will usually use events like Enlight_Controller_Dispatcher_ControllerPath_Frontend_Test
or Enlight_Controller_Action_Pre"><!-- Twitter --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Bootstrapping Shopware: The dispatch loop"><meta name="twitter:description" content="When writing Shopware plugins, you will usually use events like Enlight_Controller_Dispatcher_ControllerPath_Frontend_Test
or Enlight_Controller_Action_Pre"><meta name="twitter:image" content=""><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><meta name="theme-color" content="#26556f"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:700,600,400" type="text/css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/github-gist.min.css"><link rel="stylesheet" href="https://developers.shopware.com/assets/css/docsearch.min.1515505347.css"><link rel="stylesheet" href="https://developers.shopware.com/assets/css/basic.1515505347.css" media="screen"><link rel="alternate" type="application/atom+xml" href="https://developers.shopware.com/blog/atom.xml" title="Shopware Developer blog feed"></head><body>
<div class="wrapper">

    <header class="header--main"><a href="https://developers.shopware.com/" class="offcanvas--trigger" title="Navigation">
            <i class="icon-list"></i>
        </a>

        <a href="https://developers.shopware.com/" title="Shopware Developer Documentation" class="logo">
            <img src="https://developers.shopware.com/assets/img/shopware_developers_logo_white.1515505347.svg"></a>

    </header><div id="searchBox">
        <form action="#" method="get" id="search-form">
            <input type="text" id="search-query" name="q" placeholder="Search" autocomplete="off"><button id="search-action"></button>
        </form>
    </div>

    <nav class="navi--main" data-offcanvas="true"><div class="navi--content">
            <ul class="navi--tree"><li class="navi--chapter">
                    <a href="/developers-guide/" class="navi--link has--children">
                       Developer Guides
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/plugin-guide/">
                                Developing plugins
                            </a>

                                                            <ul class="navi--sub-tree is--numbered"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-quick-start/">
                                                Quick start guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/example-plugin/">
                                                Storefront extension
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/controller/">
                                                Controllers
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/models/">
                                                Models
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/event-guide/">
                                                Events
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/services/">
                                                Services
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-configuration/">
                                                Plugin configuration
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-testing/">
                                                Plugin testing
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-license/">
                                                Plugin License
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-plugin-update-guide/">
                                                Plugin update guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-extension-by-plugin/">
                                                Extend an existing plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/legacy-plugin-system/">
                                                The legacy Plugin System
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/general-resources/">
                                General Resources
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/cheat-sheet/">
                                                Cheat-Sheet
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/phpstorm/">
                                                Setting up PhpStorm
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-upgrade-guide-for-developers/">
                                                Upgrade Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-performance-for-devs/">
                                                Performance Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/debugging/">
                                                Debugging Shopware
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/coding-standards/">
                                                Coding Standards
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/elasticsearch/">
                                                Elasticsearch
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-config/">
                                                config.php settings
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/blog/2015/06/09/understanding-the-shopware-hook-system/">
                                                Hooks
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/blog/2015/08/11/the-shopware-seo-engine/">
                                                SEO Engine
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-media-service/">
                                                MediaService
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/http-cache/">
                                                HTTP Cache
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/address-management-guide/">
                                                Address Management
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/attribute-system/">
                                                Attributes
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/csrf-protection/">
                                                CSRF Protection
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/dic-tags/">
                                                Dependency Injection Tags
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-cli-commands/">
                                                CLI commands
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/implementing-your-own-captcha/">
                                                Captcha
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-search-bundle/">
                                                SearchBundle
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/shopware-5-core-service-extensions/">
                                                Service extensions
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/entity-relationship-model/">
                                                Entity relationship model
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/password-encoder/">
                                                Password encoder
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/global-variables-in-templates/">
                                                Global variables in templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/media-optimizer/">
                                                Media Optimizer
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/customer-streams-extension/">
                                                Customer - Search &amp; Streams
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/product-export/">
                                                Product exports
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/tutorials/">
                                Tutorials
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/custom-shopping-world-elements/">
                                                Create custom shopping worlds elements
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/digital-publishing-elements/">
                                                Create custom digital publishing elements
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/emotion-preset-plugin/">
                                                Create custom emotion preset plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-lastregistrations-widget/">
                                                Create your own backend widget
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/payment-plugin/">
                                                Create custom payment plugin
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/plugin-slugify/">
                                                Create custom url slugger
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/risk-rules/">
                                                Risk Rules
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/vagrant-phpstorm/">
                                                Vagrant and PHPStorm
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/backend-and-extjs/">
                                Backend and ExtJS
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-extension/">
                                                Extending the backend
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/basics/">
                                                Basics
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/listing/">
                                                Listing
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/detail/">
                                                Detail
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/associations/">
                                                Associations
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/listing-extensions/">
                                                Listing extensions
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-components/batch-processes/">
                                                Batch processes
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/lightweight-backend-modules/">
                                                Lightweight backend modules
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/backend-icons/">
                                                Backend icon set
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/backend-escaping/">
                                                Backend escaping
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/developers-guide/rest/">
                                REST API
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/">
                                                REST API Basics
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/article/">
                                                The article resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/customer/">
                                                The customer resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/order/">
                                                The order resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/translation/">
                                                The translation resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/category/">
                                                The category resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/media/">
                                                The media resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/merge-mode/">
                                                The merge mode
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/cache/">
                                                The cache resources
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/batch/">
                                                The batch mode
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/api-resource-user/">
                                                The user resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/customer-streams/">
                                                Customer Streams
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/filter/">
                                                Filter
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/examples/payment/">
                                                Payment
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/models/">
                                                Models
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/plugin-api-extension/">
                                                Create your own endpoint
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/extend-api-resource/">
                                                Extend a REST API resource
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/developers-guide/rest-api/faq/">
                                                REST API FAQ
                                            </a>
                                        </li>
                                                                    </ul></li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/designers-guide/" class="navi--link has--children">
                       Frontend Guides
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/theme-guide/">
                                Developing Themes
                            </a>

                                                            <ul class="navi--sub-tree is--numbered"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/theme-startup-guide/">
                                                Theme Startup Guide
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/getting-started/">
                                                Getting started with templating
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/smarty/">
                                                Getting started with Smarty
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/less/">
                                                Getting started with LESS
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/css-and-js-files-usage/">
                                                Using CSS and JavaScript
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/responsive-theme-default-components/">
                                                Using the theme default components
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/javascript-statemanager-and-pluginbase/">
                                                jQuery plugins &amp; the StateManager
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/configuration-using-theme-php/">
                                                Custom theme configuration
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/preparing-themes-for-the-community-store/">
                                                Preparing themes for the community store
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/designers-guide/general-resources/">
                                General Resources
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/eslint-for-plugins/">
                                                ESLint for plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/javascript-coding-style/">
                                                Javascript Coding Style
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/styletile/">
                                                UI Components
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/snippets/">
                                                Snippet Management
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/datepicker/">
                                                Datepicker
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/external-resources/">
                                                Embedding external resources
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/responsive-images/">
                                                Responsive images
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/smarty-plugins/">
                                                Smarty Plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/best-practice-theme-development/">
                                                Using the Grunt watcher
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/modify-jquery-plugins/">
                                                Modify jQuery plugins
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/managing-third-party-dependencies-with-bower/">
                                                Managing dependencies with Bower
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/managing-third-party-dependencies-with-npm/">
                                                Managing dependencies with NPM
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/legacy-template-development-in-shopware-5/">
                                                Legacy template development
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/how-to-use-karma/">
                                                Testing with Karma
                                            </a>
                                        </li>
                                                                    </ul></li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link has--children" href="/designers-guide/tutorials/">
                                Tutorials
                            </a>

                                                            <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/find-smarty-blocks/">
                                                How to find smarty blocks
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-templates/">
                                                Adding custom templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-listing-page/">
                                                Example: Custom listing page
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/custom-detail-page/">
                                                Example: Custom Detail page
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/edit-newsletter-and-document-templates/">
                                                Edit newsletter and document templates
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/google-pagespeed-best-practise/">
                                                Google PageSpeed
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/browser-notice/">
                                                Outdated browser notification
                                            </a>
                                        </li>
                                                                            <li class="navi--sub-chapter">
                                            <a class="navi--link" href="/designers-guide/range-slider-algorithm/">
                                                Range slider algorithm
                                            </a>
                                        </li>
                                                                    </ul></li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/community/" class="navi--link has--children">
                       Community
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/gitter/">
                                Gitter
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/contribution-guideline/">
                                Contribution Guideline
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/contributing-code/">
                                Contributing Code
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/community/irc/">
                                IRC Channel
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/labs/" class="navi--link has--children">
                       Labs
                    </a>

                                        <ul class="navi--sub-tree is--bulleted"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/3d-product-visualization/">
                                3D Product visualization
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/shopping-cart-and-ordering-processes/">
                                Shopping Cart &amp; ordering processes
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/new-administration/">
                                New administration
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/internationalization/">
                                Internationalization
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/api/">
                                API
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/labs/housekeeping/">
                                Housekeeping
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/sysadmins-guide/" class="navi--link has--children">
                       System Guides
                    </a>

                                        <ul class="navi--sub-tree"><li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/system-requirements/">
                                System requirements
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/installation-guide/">
                                Installation Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/update-guide/">
                                Update Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/shopware-5-performance-for-sysadmins/">
                                Performance Guide
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/elasticsearch-setup/">
                                Elasticsearch setup
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/varnish-setup/">
                                Varnish setup
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/sessions/">
                                Sessions
                            </a>

                                                    </li>
                                                <li class="navi--sub-chapter">

                            <a class="navi--link" href="/sysadmins-guide/shopware-cluster-setup/">
                                Cluster setup
                            </a>

                                                    </li>
                                            </ul></li>

                
                <li class="navi--chapter">
                    <a href="/blog/" class="navi--link">
                       Blog
                    </a>

                                    </li>

                            </ul></div>
    </nav><div class="devdocs content">

        <section id="search-results" style="display: none;"><h2 class="search-results--headline" id="search-results">Search results</h2>

            <div class="entries"></div>
        </section><div class="inner-container">

            <div class="info">

                
                                <a class="edit-on-github" href="https://github.com/shopware/devdocs/blob/master/source/blog/_posts/2015-08-26-dispatch-loop.md" target="_blank"><i class="icon-github"></i> Edit this page on GitHub</a>
                
            </div>

                        <h1>
                Bootstrapping Shopware: The dispatch loop
            </h1>
            
            <article class="blog-post"><div class="blog-authors">
                        <div class="blog-user-info">
    <div class="blog-avatar">
        <img src="https://developers.shopware.com/blog/img/authors/author_dn.jpg" width="50" height="50"></div>
    <div class="blog-user">
        <div class="user-info">
            <a rel="author" href="https://developers.shopware.com/blog/authors/dn">Daniel NÃ¶gel</a>
            <span class="user-title">, Developer</span>        </div>

        <div class="release">
            <span class="icon icon-clock"></span> August 26th, 2015
        </div>

        <div class="user-services">

                            <span class="user-service">
                    <a href="https://twitter.com/danielnoegel" target="_blank" title="Twitter Daniel NÃ¶gel">
                        <span class="service-desc">Twitter: </span> <i class="icon icon-twitter"></i>
                    </a>
                </span>
            
                            <span class="user-service">
                    <a href="https://danielnoegel.de" target="_blank" title="Website Daniel NÃ¶gel">
                        <span class="service-desc">Website: </span> <i class="icon icon-globe"></i>
                    </a>
                </span>
            
                            <span class="user-service">
                    <a href="https://github.com/dnoegel/" target="_blank" title="Github Daniel NÃ¶gel">
                        <span class="service-desc">Github: </span> <i class="icon icon-github"></i>
                    </a>
                </span>
                    </div>
    </div>
</div>
                    </div>
    
    <div class="blog-detail-text">
        <p>When writing Shopware plugins, you will usually use events like <code>Enlight_Controller_Dispatcher_ControllerPath_Frontend_Test</code>
or <code>Enlight_Controller_Action_PreDispatch_Frontend_Listing</code>. But where do those names originate from and what is the
&quot;big picture&quot; behind it?
This post will explain what happens &quot;behind the scenes&quot;, when Shopware boots up and handles a request.</p>

<h1>Dispatch Loop</h1>

<p>Dispatching is the process of handling a <code>Request</code> object, extracting the relevant <code>Module</code>, <code>Controller</code> and <code>Action</code> from it,
instantiating the correct controller and making this controller handle the request.
As controllers can forward to other controllers, this is actually a loop - Shopware will run through that loop, until no
additional requests needs to be handled.</p>

<h1>Where it all begins: The front controller</h1>

<p>Whenever a request hits your server, your web server will redirect it to the <code>shopware.php</code> file. There shopware will
instantiate the <code>\Shopware\Kernel</code>, which implements <code>\Symfony\Component\HttpKernel\HttpKernelInterface</code>. The <code>handle</code>
method of the kernel will then bootstrap the rest of Shopware (e.g. plugins) and start the dispatch loop.
The actual dispatch loop is handled by <code>\Enlight_Controller_Front::dispatch</code>.
This front controller will take care of the following tasks:</p>

<ul><li>run the router on the request object, so the router can figure out, which <code>Module</code>, <code>Controller</code> and <code>Action</code> needs to be requested</li>
<li>run the dispatch loop, until there is nothing more to process</li>
<li>within any loop iteration, trigger the <code>\Enlight_Controller_Dispatcher_Default::dispatch</code> which will take care of the rest</li>
</ul><p>The front controller also emits some very early events, that might be useful in some cases:</p>

<ul><li>
<code>Enlight_Controller_Front_StartDispatch</code>: At the very beginning, before the front controller will actually handle the request</li>
<li>
<code>Enlight_Controller_Front_RouteStartup</code>: Before the front controller will pass the <code>Request</code> object to the router in order to populate it</li>
<li>
<code>Enlight_Controller_Front_RouteShutdown</code>: Just after the router handled the <code>Request</code> object. Now the routing information is available</li>
<li>
<code>Enlight_Controller_Front_DispatchLoopStartup</code>: Before the dispatch loop</li>
<li>
<code>Enlight_Controller_Front_PreDispatch</code>: Before the current <code>Request</code> object is passed to the <code>Dispatcher</code>
</li>
<li>
<code>Enlight_Controller_Front_PostDispatch</code>: After the current <code>Request</code> object is passed to the `Dispatcher</li>
<li>
<code>Enlight_Controller_Front_DispatchLoopShutdown</code>: After the dispatch loop</li>
</ul><h2 id="router">Router</h2>

<p>To get an impression of what the router does, let's look at this example: We open the URL <code>http://localhost/media/living/</code>
and look at the request object <strong>before</strong> routing:</p>

<pre><code>object(Enlight_Controller_Request_RequestHttp)[379]
  private 'validDeviceTypes' =&gt;
    array (size=3)
      0 =&gt; string 'desktop' (length=7)
      1 =&gt; string 'tablet' (length=6)
      2 =&gt; string 'mobile' (length=6)
  protected '_paramSources' =&gt;
    array (size=2)
      0 =&gt; string '_GET' (length=4)
      1 =&gt; string '_POST' (length=5)
  protected '_requestUri' =&gt; string '/media/living/' (length=18)
  protected '_baseUrl' =&gt; string '/media' (length=6)
  protected '_basePath' =&gt; string '/media' (length=6)
  protected '_pathInfo' =&gt; string '/living/' (length=12)
  protected '_params' =&gt;
    array (size=0)
      empty
  protected '_rawBody' =&gt; null
  protected '_aliases' =&gt;
    array (size=0)
      empty
  protected '_dispatched' =&gt; boolean false
  protected '_module' =&gt; null
  protected '_moduleKey' =&gt; string 'module' (length=6)
  protected '_controller' =&gt; null
  protected '_controllerKey' =&gt; string 'controller' (length=10)
  protected '_action' =&gt; null
  protected '_actionKey' =&gt; string 'action' (length=6)
</code></pre>

<p>As you can see, <code>module</code>, <code>controller</code> and <code>action</code> are <code>null</code>. After the routing (the router can be found in <code>engine/Shopware/Components/Routing</code>)
the <code>request</code> object will look like this:</p>

<pre><code>object(Enlight_Controller_Request_RequestHttp)[379]
  private 'validDeviceTypes' =&gt;
    array (size=3)
      0 =&gt; string 'desktop' (length=7)
      1 =&gt; string 'tablet' (length=6)
      2 =&gt; string 'mobile' (length=6)
  protected '_paramSources' =&gt;
    array (size=2)
      0 =&gt; string '_GET' (length=4)
      1 =&gt; string '_POST' (length=5)
  protected '_requestUri' =&gt; string '/media/living/' (length=18)
  protected '_baseUrl' =&gt; string '/media' (length=6)
  protected '_basePath' =&gt; string '/media' (length=6)
  protected '_pathInfo' =&gt; string '/living/' (length=12)
  protected '_params' =&gt;
    array (size=0)
      empty
  protected '_rawBody' =&gt; null
  protected '_aliases' =&gt;
    array (size=0)
      empty
  protected '_dispatched' =&gt; boolean false
  protected '_module' =&gt; string 'frontend' (length=8)
  protected '_moduleKey' =&gt; string 'module' (length=6)
  protected '_controller' =&gt; string 'cat' (length=3)
  protected '_controllerKey' =&gt; string 'controller' (length=10)
  protected '_action' =&gt; string 'index' (length=5)
  protected '_actionKey' =&gt; string 'action' (length=6)
</code></pre>

<p>This time, the relevant information is set, the router resolved the SEO URL <code>/media/living/</code> to the correct <code>module</code>, <code>controller</code>
and <code>aciton</code>. Now everything is prepared to handle the <code>request</code> object by the dispatcher.</p>

<h2 id="dispatcher">Dispatcher</h2>

<p>The Shopware dispatcher will handle a request in <code>\Enlight_Controller_Dispatcher_Default::dispatch</code>. First of all, it will build
a controller name from the request object, so e.g.</p>

<pre><code>[
   'module' =&gt; 'frontend',
   'controller' =&gt; 'listing',
   'action' =&gt; 'index',
]
</code></pre>

<p>will become <code>Shopware_Controllers_Frontend_Listing</code>. The controller dispatcher will then emit the event
<code>Enlight_Controller_Dispatcher_ControllerPath_Frontend_Listing</code>, so that plugin developers can register this controller.
If no plugin returns a result, the Dispatcher will try to find this controller in Shopware's controller directory <code>engine/Shopware/Controllers</code>.
Either way, the dispatcher will now have a path for the controller, e.g. <code>engine/Shopware/Controllers/Frontend/Listing.php</code>
which it now will include and instantiate. Furthermore it injects the <code>Request</code>, <code>Response</code>, <code>Container</code> and <code>Front</code> object into that controller.
As it uses a proxy object for the controller, all controllers are hookable by default.</p>

<p>Finally the dispatcher will call the <code>dispatch</code> method on the controller. As every controller in Shopware extends from
<code>Enlight_Controller_Action</code>, you might not have seen this method, yet - but it is always there.</p>

<h2 id="controller-dispatching">Controller dispatching</h2>

<p>Now <code>\Enlight_Controller_Action::dispatch</code> will handle the actual dispatch for the current controller. First of all, an <code>\Enlight_Controller_ActionEventArgs</code>
object is created - it will be passed to all pre- and post dispatch events of that controller.
After that, the <code>PreDispatch</code> events are triggered, for the current controller:</p>

<pre><code>Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PreDispatch',
    $args
);

Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PreDispatch_' . $moduleName,
    $args
);

Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PreDispatch_' . $this-&gt;controller_name,
    $args
);
</code></pre>

<p>This will generate events like:</p>

<ul><li>
<code>Enlight_Controller_Action_PreDispatch</code>
</li>
<li>
<code>Enlight_Controller_Action_PreDispatch_Frontend</code>
</li>
<li>
<code>Enlight_Controller_Action_PreDispatch_Frontend_Listing</code>
</li>
</ul><p>depending of the current module and controller. As you see, the <code>Enlight_Controller_Action</code> prefix of the event name
directly derives from the <code>Enlight_Controller_Action</code> class, that emits the events. The first event does not have a module or
controller name in it - so every controller will emit it - that's why this event is always available.
The second event just appends the module name to the event name - that's the reason, why there is a <code>Enlight_Controller_Action_PreDispatch_Frontend</code>
event for every single controller in the frontend.</p>

<p>After emitting all the events, the controller dispatcher will call the <code>preDispatch</code> method of the controller itself. So if
you  have implemented the <code>preDispatch</code> method in your controller, it will now be executed.
Next the event <code>Enlight_Controller_Action_Frontend_Listing_Index</code> is emitted. This is the &quot;action&quot; event - if a plugin
subscribed to it, it can handle the controller action instead of the default action implementation. So instead of executing
<code>Shopware_Controllers_Frontend_Listing::indexAction</code> only the plugin subscriber will be executed.
If no plugin registered to that event, the controller dispatcher will execute the actual controller action, in our case
<code>Shopware_Controllers_Frontend_Listing::indexAction</code>.</p>

<p>Now the <code>postDispatch</code> method of the controller is executed - just like the <code>preDispatch</code> method before. Finally the post dispatch events
are emitted, that you will know from most plugins:</p>

<pre><code>if ($this-&gt;Request()-&gt;isDispatched() &amp;&amp; !$this-&gt;Response()-&gt;isException() &amp;&amp; $this-&gt;View()-&gt;hasTemplate()) {
    Enlight_Application::Instance()-&gt;Events()-&gt;notify(
        __CLASS__ . '_PostDispatchSecure_' . $this-&gt;controller_name,
        $args
    );

    Enlight_Application::Instance()-&gt;Events()-&gt;notify(
        __CLASS__ . '_PostDispatchSecure_' . $moduleName,
        $args
    );

    Enlight_Application::Instance()-&gt;Events()-&gt;notify(
        __CLASS__ . '_PostDispatchSecure',
        $args
    );
}

Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PostDispatch_' . $this-&gt;controller_name,
    $args
);

Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PostDispatch_' . $moduleName,
    $args
);

Enlight_Application::Instance()-&gt;Events()-&gt;notify(
    __CLASS__ . '_PostDispatch',
    $args
);
</code></pre>

<p>As you can see, the events</p>

<ul><li>Enlight_Controller_Action_PostDispatchSecure_Frontend_Listing</li>
<li>Enlight_Controller_Action_PostDispatchSecure_Frontend</li>
<li>Enlight_Controller_Action_PostDispatchSecure</li>
</ul><p>will only be emitted, when no exception occurred, a template is available and the request has actually been handled (&quot;dispatched&quot;).
This is, why we call them &quot;secure&quot;, as you as a plugin developer can rely on this events indicating a &quot;proper&quot; dispatch and don't
need to check for e.g. exceptions by yourself. That is the reason, why we highly recommend this events over the non-secure events,
which will be emitted afterwards:</p>

<ul><li>Enlight_Controller_Action_PostDispatch_Frontend_Listing</li>
<li>Enlight_Controller_Action_PostDispatch_Frontend</li>
<li>Enlight_Controller_Action_PostDispatch</li>
</ul><h1>Where does the template come from?</h1>

<p>At this point, we have seen the whole dispatching in Shopware. Perhaps you will ask yourself, where the template comes into
play and when it is rendered. This is something <code>\Enlight_Controller_Plugins_ViewRenderer_Bootstrap</code> will take care of.
At the end of a request (PostDispatch), it will get the <code>\Enlight_View</code> object from the controller, render the template and
append the result to the response object. The output of e.g. the rendered template will then happen in <code>shopware.php</code>, where it all started
in the <code>\Symfony\Component\HttpFoundation\Response::send</code> method.</p>

<h1>Understanding the {action} plugin</h1>

<p>As you might know, Shopware provides a nice Smarty plugin called <code>action</code>, that will allow you, to render results from other
controller calls into your template. If an HTTP cache is enabled, this will happen using <a href="https://en.wikipedia.org/wiki/Edge_Side_Includes">ESI tags</a>.
If no HTTP cache is enabled, Shopware is able to handle those requests without performing an additional HTTP request - it
will just enter a second dispatch loop and will make it handle the sub request. The resulting template of that sub request
can then be just printed out, so that it is included in the surrounding main request.
This way, Shopware does not need to run a full bootstrapping process again - all resources like plugins, services in the DI container
or the database connection are shared.</p>

<h1>Symfony and Enlight</h1>

<p>As you have seen, the actual bootstrapping of Shopware happens with a Symfony Kernel, that's why we are &quot;Symfony http kernel compliant&quot;
and can e.g. use the Symfony HTTP revers proxy for caching. Internally, Shopware will convert the Symfony request object
to an Enlight request object, handle it in the dispatch loop and convert the resulting Enlight response object back to a
Symfony response object.
As Enlight is basically a thin layer above the Zend framework, the dispatch loop is heavily inspired by zend framework,
the <a href="http://framework.zend.com/manual/1.12/en/zend.controller.html">Zend controller basics</a> might provide you additional insights.</p>

    </div>

    <a href="https://developers.shopware.com/blog/" title="Back to overview" class="btn btn-default">Back to overview</a>

    <div class="clearfix"></div>
</article></div>

        <div class="clearfix"></div>
    </div>
    
    <!-- Footer -->
            <footer class="main-footer"><div class="footer--container">
                <div class="copyright">2018 Â© shopware AG - All rights reserved</div>
                <div class="footer--links">
                    <a href="https://en.shopware.com/legal-notice" target="_blank" title="Imprint">Imprint</a> |
                    <a href="https://en.shopware.com/gtc" target="_blank" title="Terms and Conditions">Terms and Conditions</a>
                </div>
            </div>
        </footer></div>

<script src="//cdn.jsdelivr.net/jquery/2.1.4/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/languages/less.min.js"></script><script src="https://developers.shopware.com/assets/js/anchor.min.1515505347.js"></script><script src="https://developers.shopware.com/assets/js/jquery.expandCode.1515505347.js"></script><script src="https://developers.shopware.com/assets/js/jquery.toc.1515505347.js"></script><script src="https://developers.shopware.com/assets/js/jquery.offcanvas.1515505347.js"></script><script src="https://developers.shopware.com/assets/js/app.1515505347.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script><!-- Google Tag Manager --><noscript>
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5ZGXBG" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<script>(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
        'gtm.start': new Date().getTime(), event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
            '//www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
})(window, document, 'script', 'dataLayer', 'GTM-5ZGXBG');</script><!-- End Google Tag Manager --></body></html>